<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="icon" href="logo_proyecto_atlas.png" type="image/png" />
<title>Proyecto Atlas ‚Äî Archivo</title>
<style>
  :root{--bg:#0b0d10;--panel:#111418;--muted:#2a2f36;--accent:#1f6feb;--text:#e6e6e6;--sub:#a6b0bb;--radius:16px;}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
  header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,#0b0d10,#0b0d10ee 80%,transparent);border-bottom:1px solid #1c2128;padding:14px 18px}
  .brand{display:flex;gap:12px;align-items:center;max-width:1100px;margin:auto}
  .badge img{width:40px;height:40px;border-radius:10px;border:1px solid #2a3442;background:#182032;display:block}
  .meta h1{margin:0;font-size:18px;letter-spacing:.4px}
  .meta .ref{font-size:12px;color:var(--sub);opacity:.85}
  main{max-width:1100px;margin:22px auto;padding:0 18px;display:grid;grid-template-columns:260px 1fr;gap:18px}
  @media (max-width:960px){ main{grid-template-columns:1fr} }
  .side{background:var(--panel);border:1px solid var(--muted);border-radius:var(--radius);padding:14px;position:sticky;top:78px;height:max-content}
  .side h3{margin:0 0 8px 0;font-size:14px;color:var(--sub);text-transform:uppercase;letter-spacing:.12em}
  .doclist{display:flex;flex-direction:column;gap:8px}
  .doc{display:flex;justify-content:space-between;align-items:center;gap:8px;padding:10px 12px;border:1px solid #23262b;border-radius:12px;background:#0e1116;cursor:pointer}
  .doc[aria-current="true"]{outline:2px solid var(--accent)}
  .doc .name{font-size:14px}
  .doc .lock{font-size:12px;opacity:.8}
  .card{background:var(--panel);border:1px solid var(--muted);border-radius:var(--radius);padding:16px;box-shadow:0 14px 30px rgba(0,0,0,.3)}
  .tag{display:inline-flex;gap:8px;align-items:center;font-size:12px;color:var(--sub)}
  .hint{font-size:12px;color:var(--sub);margin-top:6px}

  /* Imagen */
  .imgbox{border:1px solid #23262b;border-radius:12px;overflow:hidden;background:#0e1116;position:relative;margin-top:8px}
  #docImage{display:block;width:100%;height:auto;filter:brightness(var(--b,1)) contrast(var(--c,1));transition:filter .2s ease}
  .imgbox.locked::after{
    content:"Documento bloqueado";
    position:absolute; inset:0; display:grid; place-items:center;
    background:rgba(0,0,0,.65); font-weight:700; letter-spacing:.08em;
  }

  /* Audio */
  #audioBox{margin-top:10px}
  #audioBox .caption{font-size:12px;color:var(--sub);margin-bottom:4px}

  /* Controles */
  .controls{display:flex;gap:14px;flex-wrap:wrap;margin-top:10px}
  .controls label{font-size:12px;color:var(--sub);display:flex;flex-direction:column;gap:6px}
  input[type="range"]{width:200px}
  button{background:var(--accent);color:white;border:none;border-radius:12px;padding:10px 14px;cursor:pointer;font-weight:600}
  button.secondary{background:#1b232d}
  button.ghost{background:transparent;border:1px solid #2a2f36}
  .controls.disabled{opacity:.5;pointer-events:none;}
  .nav{display:flex;justify-content:space-between;gap:8px;margin-top:12px}
</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="badge"><img src="logo_proyecto_atlas.png" alt="Logo"></div>
    <div class="meta">
      <h1>Proyecto Atlas ‚Äî Archivo</h1>
      <div class="ref">Expediente: ATLAS-03 ¬∑ Unidad Especial ¬∑ Acceso restringido</div>
    </div>
  </div>
</header>

<main>
  <!-- Lateral -->
  <aside class="side">
    <h3>Documentos</h3>
    <div id="docList" class="doclist" role="list"></div>
    <div class="hint" style="margin-top:10px">Los documentos con candado requieren una clave encontrada en los materiales f√≠sicos.</div>
  </aside>

  <!-- Principal -->
  <section class="card" aria-live="polite">
    <div class="tag">Ref: <span id="refId">‚Äî</span></div>
    <h2 id="docTitle" style="margin:.3rem 0 0.6rem 0">Documento</h2>
    <p id="docIntro" class="hint"></p>

    <!-- Audio (se muestra solo si el doc es de tipo audio) -->
    <div id="audioBox"></div>

    <!-- Imagen (se muestra solo si el doc es de tipo imagen) -->
    <div class="imgbox" id="imgBox" style="display:none"><img id="docImage" alt=""></div>

    <!-- Controles imagen -->
    <div class="controls" id="imgControls" style="display:none">
      <label>Brillo
        <input id="br" type="range" min="0.5" max="2" step="0.01" value="1">
      </label>
      <label>Contraste
        <input id="ct" type="range" min="0.5" max="2" step="0.01" value="1">
      </label>
      <button id="reset" class="secondary">Reiniciar</button>
      <button id="download" class="ghost">Descargar</button>
    </div>

    <div class="nav">
      <button id="prev" class="ghost">‚Üê Anterior</button>
      <button id="next">Siguiente ‚Üí</button>
    </div>
  </section>
</main>

<!-- Modal desbloqueo -->
<dialog id="unlockDialog">
  <form method="dialog" class="modal">
    <h3>Desbloquear documento</h3>
    <p>Introduce la clave encontrada en el caso para acceder.</p>
    <div class="row" style="display:flex;gap:8px">
      <input id="unlockInput" placeholder="Introduce la clave" autocomplete="off" />
      <button id="unlockBtn" value="ok">Desbloquear</button>
      <button value="cancel" class="ghost">Cancelar</button>
    </div>
    <p id="unlockMsg" class="hint"></p>
  </form>
</dialog>

<script>
/* Siempre limpio al recargar */
localStorage.removeItem("atlas_web_state_v1");

/* === Definici√≥n de documentos ===
   type: "audio" | "image"
   - audio: usar audioSrc
   - image: usar img y auto (brillo/contraste inicial)
*/
const DOCS = [
  {
    id:"doc1",
    type:"audio",
    title:"ATLAS-03/0001",
    ref:"ATLAS-03/DOC-0001",
    intro:"Mensaje inicial del Dr. Serrano.",
    audioSrc:"audio_victor.mp3",
    locked:false
  },
  {
    id:"doc2",
    type:"image",
    title:"ATLAS-03/0002",
    ref:"ATLAS-03/DOC-0002",
    intro:"Imagen del laboratorio. Ajusta brillo/contraste para revelar detalles.",
    img:"laboratorio_acto1.png",
    auto:{b:2,c:2},
    locked:true,
    pass:"carmen1706"
  },
  {
    id:"doc3",
    type:"image",
    title:"ATLAS-03/0003",
    ref:"ATLAS-03/DOC-0003",
    intro:"Contenido protegido. Requiere la clave obtenida en el Acto 2.",
    img:"",
    auto:{b:1,c:1},
    locked:true,
    pass:"muelle"
  }
];

const $ = sel => document.querySelector(sel);
let state = { unlocked:{ doc1:true }, current:"doc1" };

/* Helpers */
function setImgControlsDisabled(v){
  ["br","ct","reset","download"].forEach(id => { const el = document.getElementById(id); if(el) el.disabled = v; });
  document.getElementById("imgControls").classList.toggle("disabled", v);
}
function applyFilters(b,c){
  $("#br").value = b; $("#ct").value = c;
  const img = $("#docImage");
  img.style.setProperty("--b", b);
  img.style.setProperty("--c", c);
}

/* Lista lateral */
function renderList(){
  const list = $("#docList");
  list.innerHTML = "";
  DOCS.forEach(d=>{
    const li = document.createElement("button");
    li.className = "doc";
    li.setAttribute("role","listitem");
    li.dataset.id = d.id;

    const name = document.createElement("span");
    name.className = "name";
    name.textContent = d.title;

    const lock = document.createElement("span");
    lock.className = "lock";
    const isOpen = state.unlocked[d.id] || !d.locked;
    lock.textContent = d.locked ? (isOpen ? "üîì" : "üîí") : "";

    li.appendChild(name); li.appendChild(lock);
    if(state.current === d.id) li.setAttribute("aria-current","true");
    li.onclick = ()=> openDoc(d.id);
    list.appendChild(li);
  });
}

/* Render audio */
function renderAudio(d, isOpen){
  const box = $("#audioBox");
  if(d.type !== "audio"){ box.innerHTML = ""; return; }
  if(isOpen){
    box.innerHTML = `
      <div class="caption">Audio 1 ‚Äî Mensaje de V√≠ctor</div>
      <audio controls preload="auto" src="${d.audioSrc}"></audio>
    `;
  } else {
    box.innerHTML = "";
  }
}

/* Abrir documento */
function openDoc(id){
  state.current = id;
  const d = DOCS.find(x=>x.id===id);
  const isOpen = state.unlocked[id] || !d.locked;

  $("#refId").textContent = d.ref;
  $("#docTitle").textContent = d.title;
  $("#docIntro").textContent = d.intro;

  const imgBox = $("#imgBox");
  const img = $("#docImage");
  const imgControls = $("#imgControls");

  if(d.type === "audio"){
    // Mostrar audio, ocultar imagen/controles
    renderAudio(d, true);
    imgBox.style.display = "none";
    imgControls.style.display = "none";
  } else {
    // Es imagen: limpiar audio y mostrar img (seg√∫n bloqueo)
    renderAudio(d, false);
    imgBox.style.display = "block";
    imgControls.style.display = "flex";

    if(isOpen){
      img.src = d.img || "";
      img.alt = d.title;
      imgBox.classList.remove("locked");
      setImgControlsDisabled(false);
      applyFilters(d.auto?.b || 1, d.auto?.c || 1);
    } else {
      img.src = ""; // no mostramos nada si est√° bloqueado
      img.alt = "Documento bloqueado";
      imgBox.classList.add("locked");
      setImgControlsDisabled(true);
      applyFilters(1,1);
      unlockDialog.showModal();
    }
  }

  renderList();
}

/* Sliders */
$("#br").oninput = $("#ct").oninput = ()=> applyFilters(parseFloat($("#br").value), parseFloat($("#ct").value));
$("#reset").onclick = ()=> applyFilters(2,2);
$("#download").onclick = ()=>{
  const d = DOCS.find(x=>x.id===state.current);
  if(!d || d.type!=="image" || !d.img) return;
  const a = document.createElement("a");
  a.href = d.img; a.download = d.img.split("/").pop();
  a.click();
};

/* Navegaci√≥n */
$("#prev").onclick = ()=>{
  const idx = DOCS.findIndex(x=>x.id===state.current);
  if(idx>0) openDoc(DOCS[idx-1].id);
};
$("#next").onclick = ()=>{
  const idx = DOCS.findIndex(x=>x.id===state.current);
  if(idx<DOCS.length-1) openDoc(DOCS[idx+1].id);
};

/* Desbloqueo */
const unlockDialog = $("#unlockDialog");
$("#unlockBtn").onclick = (ev)=>{
  ev.preventDefault();
  const code = $("#unlockInput").value.trim();
  const d = DOCS.find(x=>x.id===state.current);
  if((d.pass||"").toLowerCase() === code.toLowerCase()){
    state.unlocked[d.id] = true;
    $("#unlockMsg").textContent = "Desbloqueado ‚úÖ";
    setTimeout(()=>{
      unlockDialog.close();
      $("#unlockInput").value = ""; $("#unlockMsg").textContent = "";
      openDoc(d.id);
    }, 300);
  } else {
    $("#unlockMsg").textContent = "Clave incorrecta.";
  }
};
unlockDialog.addEventListener("close", ()=>{
  $("#unlockInput").value=""; $("#unlockMsg").textContent="";
});

/* Init */
renderList();
openDoc(state.current);
</script>
</body>
</html>
